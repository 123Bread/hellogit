/*! financing_clearing_system v1.0.0
*  by [object Object]
*  (c) 2014-2016 www.frontpay.cn
* updated on 2016-11-14
*  Licensed under Apache-2.0
*/
 !function(root,$){var cacheData=[],AppView=Spine.extend({EVENTS:{"#btn-add":{click:function(self,e){e.preventDefault(),e.preventDefault(),self.showAddModal(e.target)}},'[data-action="removeItem"]':{click:function(self,e){e.preventDefault(),confirmModalLayer({title:"确定删除该应付款项?",callback:function(){self.removeItem(e.target)}})}},'[data-action="editItem"]':{click:function(self,e){e.preventDefault(),self.showEditModal(e.target)}}},initialize:function(){var that=this;that.editId=null,that.$el=this.get("$el"),that.editModal=this.get("editModal"),that.addMoal=this.get("addModal"),that.listView=new PartialView({parentNode:that.get("listWrap"),template:that.get("itemTemplate")}),that.totalView=new PartialView({parentNode:that.get("totalWrap"),template:that.get("totalTemplate")});var initData=this.get("initData");"function"==typeof initData&&initData().then(function(data){data.success?(cacheData=data.list||[],that.updateView()):alertModalLayer({title:data})})},showEditModal:function(el){var url=$(el).attr("href");$(this.editModal).iframeModal({title:"编辑收款人账户信息",url:url})},hideEditModal:function(){$(this.editModal).modal("hide")},showAddModal:function(el){var url=$(el).attr("href");$(this.addMoal).iframeModal({title:"添加应收账款到代理付款明细表",url:url})},hideAddModal:function(){$(this.addMoal).modal("hide")},removeItem:function(obj){var $element=$(obj),mid=$element.data("mid");cacheData[mid]&&(cacheData.splice(mid,1),this.updateView())},updateView:function(){var currency=0;$.map(cacheData,function(el){currency+=el.amount}),this.listView.render({list:cacheData}),this.totalView.render({totalNum:cacheData.length,currency:Util.currency(currency)})},render:function(){},editSuccess:function(index,data){var that=this,curData=cacheData[index]||{};$.each(data,function(key,value){curData[key]&&(curData[key]=value)}),cacheData[index]=curData,that.updateView(),that.hideEditModal()},addSuccess:function(data){data&&(cacheData=cacheData.concat(data),this.updateView(),this.hideAddModal())}});$(function(){var app=new AppView({$el:$("#appCtrl"),itemTemplate:$("#item-template"),listWrap:$("#list-wrap"),totalWrap:$("#total-wrap"),totalTemplate:$("#total-template"),editModal:"#editModal",addModal:"#addModal",initData:function(){return $.getJSON("/static/mock_data/subjectMatterList.json")}});root.subjectMatterHandler=app})}(window,jQuery);