/*! financing_clearing_system v1.0.0
*  by [object Object]
*  (c) 2014-2016 www.frontpay.cn
* updated on 2016-11-14
*  Licensed under Apache-2.0
*/
 ~function($){var itemHandler={init:function(config){config&&(this.$add=$(config.add),this.up=config.up,this.down=config.down,this.remove=config.remove,this.$container=$(config.container),this.item=config.item,this.tmpl=$(config.tmpl).html(),this.onEvent())},onEvent:function(){this.$add.on("click",$.proxy(this.add,this)),this.$container.on("click",this.up,this.move(1,this.item,this)),this.$container.on("click",this.down,this.move(0,this.item,this)),this.$container.on("click",this.remove,this.removeItem(this))},add:function(){var items=this.$container.find(this.item),index=items.length,lastItem=items.eq(index-1),html=this.compile(++index);this.$container.append(html),this.setStatus(lastItem)},move:function(dir,item,instance){return function(e){if(e.preventDefault(),!$(this).is(".disabled")){var thisItem=$(this).closest(item),targetItem=thisItem[dir?"prev":"next"](item);thisItem[dir?"after":"before"](targetItem),instance.setStatus(thisItem),instance.setStatus(targetItem)}}},setStatus:function(item){var items=this.$container.find(this.item),len=items.length,index=items.index(item)+1,model=item.find("[data-model]");model.map(function(i,obj){"input"===obj.tagName.toLowerCase()?$(obj).prop("name",function(i,val){return val.replace(/[\d+]/g,index)}):$(obj).html(index)}),item.find(this.up).removeClass("disabled").addClass("secondary").end().find(this.down).removeClass("disabled").addClass("thirdly"),1===index&&item.find(this.up).addClass("disabled").removeClass("secondary"),index===len&&item.find(this.down).addClass("disabled").removeClass("thirdly")},removeItem:function(instance){return function(){var parent=$(this).closest(".form-group");confirmModalLayer({title:"是否删除此菜单项?",callback:function(){parent.remove(),instance.resetItems()}})}},resetItems:function(){var that=this,items=that.$container.find(this.item);items.each(function(i,item){that.setStatus($(item))})},compile:function(i){return this.tmpl.replace(/<%=index%>/g,i)}},pageInit=function(){itemHandler.init({add:"#j-add-item",up:".j-item-up",down:".j-item-down",remove:".j-item-remove",container:"#j-items",item:".form-group",tmpl:"#j-menuItem-tmpl"})};$(pageInit)}(jQuery);