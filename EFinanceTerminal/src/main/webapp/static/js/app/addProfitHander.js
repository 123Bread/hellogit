/*! financing_clearing_system v1.0.0
*  by [object Object]
*  (c) 2014-2016 www.frontpay.cn
* updated on 2016-11-14
*  Licensed under Apache-2.0
*/
 ~function($){function hideModal(){parent.profitHandler.emptyItem(),$(window).iframeModal("hide","#addProfitDialog")}var checkedHandler={init:function(){this.$el=$("#j-checked"),this.$list=$("#j-check-table"),this.$all=$("#j-checkAll"),this.render(),this.onEvent()},render:function(){if(window.frameElement){var that=this,list=parent.profitHandler.selecteItems,html=[],$checkboxs=this.$list.find(".j-checkbox");$.each(list,function(i,item){$checkboxs.filter(function(i,obj){return obj.value==item.id}).prop("checked",!0),html.push(that.getItemHtml(item))}),this.$el.html(html.join(""))}},getItemHtml:function(item){return'<span data-mid="'+item.id+'">'+item.title+'<a id="j-remove-'+item.id+'" href="javacript:void(0);" class="t-items-checked-btn"><i class="icon-clear"></i></a></span>'},onEvent:function(){var that=this;this.$el.on("click","a",function(e){e.preventDefault(),that.removeItem.call(that,this)}),this.$list.on("click",".j-checkbox",function(e){var isChecked=$(this).prop("checked");if(isChecked)that.addItem(this);else{var id=$(this).val();$("#j-remove-"+id).trigger("click"),e.preventDefault()}}),this.$all.on("click",function(e){var self=$(this),isChecked=$(this).prop("checked");isChecked?$(".j-checkbox",that.$list).each(function(){var id=$(this).val();0===$("#j-remove-"+id).length&&that.addItem(this)}).prop("checked",!0):(e.preventDefault(),that.confirm(function(){self.prop("checked",!1),$(".j-checkbox",that.$list).each(function(){if(!$(this).is(":disabled")){var id=$(this).val();that.deleteItem(id)}})}))})},removeItem:function(obj,callback){var that=this,$parent=$(obj).parent(),mid=$parent.attr("data-mid");that.confirm(function(){that.deleteItem(mid),"function"==typeof callback&&callback()})},deleteItem:function(mid){this.$el.find('span[data-mid="'+mid+'"]').remove(),$('input[value="'+mid+'"]',this.$list).attr("checked",!1),this.chkCancelAll(),parent.profitHandler.removeItem(mid),this.adjustHeight()},confirm:function(callback){parent.profitHandler.confirm(callback)},addItem:function(el){var $el=$(el),id=$el.val(),title=$el.attr("title"),item={id:id,title:title},newItem=this.getItemHtml(item);!$el.find('span[data-mid="'+id+'"]').length&&id&&(this.exists(id)||parent.profitHandler.addItem(item),this.$el.append(newItem),this.adjustHeight())},exists:function(id){var res=!1,list=parent.profitHandler.selecteItems;return $.each(list,function(i,item){item.id===id&&(res=!0)}),res},chkCancelAll:function(){var len=$(".j-checkbox:checked",this.$list).length;0===len&&this.$all.prop("checked",!1)},adjustHeight:function(){$(window).iframeModal("adjustHeight")}};$(function(){function ajaxSubmit(){if(!parent.profitHandler.selecteItems.length)return void alert("请先添加分润对象!");var ajaxReturnData=parent.profitHandler.selecteItems;parent.profitHandler.addList(ajaxReturnData),parent.successModalLayer({title:"提交成功"}),hideModal()}checkedHandler.init(),$("[data-dismiss]").on("click",hideModal),$("#j-btn-submit").on("click",function(){ajaxSubmit()})})}(jQuery);