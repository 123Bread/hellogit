/*! financing_clearing_system v1.0.0
*  by [object Object]
*  (c) 2014-2016 www.frontpay.cn
* updated on 2016-11-14
*  Licensed under Apache-2.0
*/
 ~function(root,$){var profitHandler={selecteItems:[],init:function(config){config&&(this.id="addProfitDialog",this.$btn=$(config.btn),this.$container=$(config.container),this.templateId=config.templateId,this.itemSelector=config.itemSelector,this.onEvent())},onEvent:function(){var that=this;this.$btn.on("click",$.proxy(this.showDialog,this)),this.$container.on("click",".j-remove-item",function(){that.deleteItem(this)}),this.$container.on("click",".j-default",this.setDefault(this))},showDialog:function(){var t=+new Date,url=this.$btn.attr("data-url");url=url.indexOf("?")>-1?url+"&_cache="+t:url+"?_cache="+t,$("#"+this.id).iframeModal({title:"添加分润对象",url:url})},addList:function(list){for(var $item,res=[],i=0;i<list.length;i++)$item=$(this.itemSelector+list[i].id),$item.length||res.push(list[i]);if(res.length){var listHtml=template(this.templateId,{list:res});this.$container.append(listHtml)}},addItem:function(item){var $item,items=this.selecteItems,isExists=!1;if(item&&item.id)for(var i=0,len=items.length;i<len;i++)$item=$(this.itemSelector+item.id),(items[i].id===item.id||$item.length>0)&&(isExists=!0);isExists||this.selecteItems.push(item)},removeItem:function(id){var that=this,items=this.selecteItems;if(id)for(var i=0,len=items.length;i<len;i++)items[i]&&items[i].id==id&&items.splice(i,1);$(that.itemSelector+id).remove(),this.selecteItems=items},emptyItem:function(){},setDefault:function(that){return function(){var mid=$(this).attr("data-mid"),$parent=$(this).parent(),$parents=$parent.parents(".form-group");that.$container.find(".j-def-btn").show().end().find(":hidden").remove().end().find(".form-control").removeProp("readonly"),$parent.hide(),$parents.find(".form-control").val("").prop("readonly","readonly").after('<input type="hidden" name="default['+mid+']" />')}},deleteItem:function(obj){var that=this,mid=$(obj).attr("data-mid");that.confirm(function(){that.removeItem(mid)})},confirm:function(callback){confirmModalLayer({id:"#j-deleteItem-modal",title:"是否删除此分润对象？",callback:function(){return closeModalLayer("#j-deleteItem-modal",callback),!1}})}},pageInit=function(){profitHandler.init({btn:"#j-add-profit",container:"#j-profit-container",templateId:"j-items-tmpl",itemSelector:"#j-item-"});var quickDraw=function(obj){var isChecked=$(obj)[0].checked;$(".j-quickDrwa-group").find("input").prop("readonly",!isChecked)};$("#j-quickDraw").on("click",function(){quickDraw(this)}),quickDraw($("#j-quickDraw"));var $inputPlatform=$("#j-input-paltform");$("#j-input-user").on("keyup",function(){var thisVal=Number($(this).val())||0;$inputPlatform.val(100-thisVal)})};$(pageInit),root.profitHandler=profitHandler}(window,jQuery);