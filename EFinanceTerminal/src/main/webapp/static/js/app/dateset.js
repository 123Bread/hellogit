/*! financing_clearing_system v1.0.0
*  by [object Object]
*  (c) 2014-2016 www.frontpay.cn
* updated on 2016-11-14
*  Licensed under Apache-2.0
*/
 !function(root,$,undefined){function toFixed(num,dig){return dig=dig||2,Number(num)?Number(num).toFixed(dig):num}function showEditInput(){if(!isEditing){var $num=$(this).find(".date-num"),$input=$(this).find(".num-editing"),date=$(this).attr("data-date"),$div=$(this).find("div"),numVal=0,totalNumVal=0;$(this).is(".edit-enable")&&$num.length&&(numVal=$num.attr("data-num"),totalNumVal=$num.attr("data-totalnum"),$input.length?$input.show().focus():$("<input />").attr({name:'date["'+date+'"]',type:"text","class":"num-editing","data-totalnum":totalNumVal,"data-num":numVal}).val(numVal).appendTo($div).focus())}}function removeEditInput(instance){return function(){var thisVal=$(this).val(),Num=$(this).data("num");if(isNaN(thisVal)||thisVal>Num||""==$.trim(thisVal))notifyModal||(notifyModal=!0,$.notify({message:'<i class="icon-error"></i> 请输入比默认平台收益率 '+Num+" 低的数值",timeout:2e3,onClose:function(){notifyModal=!1}})),$(this).focus(),isEditing=!0;else{var $num=$(this).prev(".date-num");$num.length&&(thisVal=parseFloat(thisVal),$(this).val(toFixed(thisVal)),$num.html(toFixed(thisVal)+"%").attr("data-num",toFixed(thisVal)).addClass("warning-FontColor")),$(this).hide(),isEditing=!1}instance.fnVlid(isEditing)}}function stopEditInput(e){e.stopPropagation()}function limitInput(e){var thisVal=$(this).val(),newValue=/^\d+/.exec(thisVal);return null==newValue?$(this).val(""):/^\d+[.]?[0-9]{0,2}$/.test(thisVal)||(newValue=/\d+[.]?[0-9]{0,2}/.exec(thisVal),$(this).val(newValue)),!1}var TBMonth=function(y,m){return this._templates=[],this.y=y,this.m=m,this.render(),this};TBMonth.digit=function(num){return num<10?"0"+(0|num):num},TBMonth.isleap=function(year){return year%4===0&&year%100!==0||year%400===0},TBMonth.months=[31,null,31,30,31,30,31,31,30,31,30,31],TBMonth.strMonths=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],TBMonth.getDay=function(y,m){return 2==m?TBMonth.isleap(y)?29:28:TBMonth.months[m-1]},TBMonth.getList=function(y,m){var min=1,max=TBMonth.getDay(y,m),list=[],newDate=new Date;newDate.setFullYear(y,m-1,1);var d=newDate.getDay();d=0==d?7:d;for(var i=1;i<d;i++)list.push("");for(;min<=max;)list.push(min++);return list},TBMonth.prototype.render=function(){var that=this,index=0,dd="",list=TBMonth.getList(that.y,that.m);that._templates.push(' <table class="date-table">'),that._templates.push("<caption>"+TBMonth.strMonths[that.m-1]+"</caption>"),that._templates.push("<thead>"),that._templates.push("<tr><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th><th>日</th></tr>"),that._templates.push("</thead>"),that._templates.push("<tbody>"),$.each(new Array(6),function(i){that._templates.push("<tr>"),$.each(new Array(7),function(j){index=7*i+j,dd=list[index]?[that.y,TBMonth.digit(that.m),TBMonth.digit(list[index])].join("-"):"",that._templates.push("<td "+(dd?'data-date="'+dd+'"':"")+(5!=j&&6!=j||!list[index]?"":' class="active"')+(5==j||6==j?' data-weekend="1"':"")+"><div>"+(list[index]?list[index]:"&nbsp;")+"</div></td>")}),that._templates.push("</tr>")}),that._templates.push("</tbody>"),that._templates.push("</table>")},TBMonth.prototype.html=function(){return this._templates.join("")};var TBYear=function(el,y,m,chks,chkings,fnValid){this.el=$(el),this.Y=y,this.M=m,this.chks=chks,this.chkings=chkings,this.fnVlid=function(){},"function"==typeof chks&&(this.fnVlid=chks),"function"==typeof chkings&&(this.fnVlid=chkings),"function"==typeof fnValid&&(this.fnVlid=fnValid),this.render(),$.isArray(chks)?this.check():$.isPlainObject(chks)&&this.hasBenefit()};TBYear.prototype.render=function(){var tables=[],tbHtml="";if(this.M&&this.M>0&&this.M<13)tbHtml=new TBMonth(this.Y,this.M).html(),tables.push(tbHtml);else for(var i=1;i<=12;i++)tbHtml=new TBMonth(this.Y,i).html(),tables.push(tbHtml);this.el.html(tables.join(""))},TBYear.prototype.check=function(){var that=this.el;$.isArray(this.chks)&&$.each(this.chks,function(i,item){$('[data-date="'+item+'"]',that).addClass("active")}),$.isArray(this.chkings)&&$.each(this.chkings,function(i,item){$('[data-date="'+item+'"]',that).addClass("active").find("div").append('<span class="date-flag">审核中</span>')})},TBYear.prototype.set=function(fn,context){fn.call(context,this.el)},TBYear.prototype.hasBenefit=function(){var config=this.chks,dateTable=this.el;if(config&&config.list){var thisItem,dateDiv,numSpan;$.each(config.list,function(i,item){thisItem=$('td[data-date="'+item.date+'"]',dateTable),numSpan=$('<span class="date-num warning-FontColor" data-totalnum="'+toFixed(item.totalnum)+'" data-num="'+toFixed(item.totalnum)+'">'+toFixed(item.totalnum)+"%</span>"),dateDiv=thisItem.find("div"),dateDiv.append(numSpan),1==item.enable&&thisItem.addClass("edit-enable"),item.totalnum!==item.num&&(config.tooltip&&dateDiv.attr({"data-toggle":"tooltips",title:"分润收益率："+toFixed(item.totalnum-item.num)+"%"}),numSpan.attr("data-num",toFixed(item.num)).html(toFixed(item.num)+"%"))}),dateTable.hasClass("date-edit")&&this.__editBenefit()}},TBYear.prototype.__editBenefit=function(){this.el.on("click","td[data-date]",showEditInput),this.el.on("blur","td .num-editing",removeEditInput(this)),this.el.on("click","td .num-editing",stopEditInput),this.el.on("keyup","td .num-editing",limitInput)};var isEditing=!1,notifyModal=!1;root.DateSet=TBYear}(window,jQuery,void 0);