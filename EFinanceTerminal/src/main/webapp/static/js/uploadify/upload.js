/*! financing_clearing_system v1.0.0
*  by [object Object]
*  (c) 2014-2016 www.frontpay.cn
* updated on 2016-11-14
*  Licensed under Apache-2.0
*/
 !function(root,$){var FileUpload=function(el,option,selector){return this.$el=$(el),this.$parent=this.$el.parent(),this.option=$.extend({},FileUpload.DEFAULTS,option),this.$input=$(this.option.inputText),this.$queue=null,this.option.pick.id=selector.indexOf("#")>-1?selector:"#"+this.$el[0].id,this.$input.length||this.option.itemTemplate?(this.init(),this):void alert("FileUpload:配置参数input尚未配置")};FileUpload.errMsg={Q_TYPE_DENIED:"文件类型有误",F_EXCEED_SIZE:"超出了文件限制大小",Q_EXCEED_NUM_LIMIT:"超出文件个数限制",Q_EXCEED_SIZE_LIMIT:"超出文件限制大小"},FileUpload.DEFAULTS={auto:!0,inputText:"#j-upload-text",fileNumLimit:1,fileSingleSizeLimit:204800,swf:"/javascript/uploadify/Uploader.swf",server:"/javascript/uploadify/fileupload.php",resize:!1,pick:{id:"",multiple:!1},accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},startUpload:$.noop,uploadBeforeSend:$.noop,beforeUpload:function(){return!0},successUpload:null},FileUpload.prototype={init:function(){var that=this;that.uploader=WebUploader.create(that.option),this.$queue=$('<div id="'+this.$el[0].id+'-queue" class="webuploader-queue"><div class="webuploader-queue-bg"></div><b>0%</b></div>').appendTo(document.body),this.render(),this.initEvent()},run:function(method){var args=[].slice.apply(arguments,1);method&&this.uploader.trigger(method,args)},render:function(){if(!this.option.itemTemplate){var offset=this.$input.offset(),w=this.$input.outerWidth(!0),h=this.$input.outerHeight(!0);this.$queue.length>0&&this.$queue.css({top:offset.top,left:offset.left,width:w,height:h,"line-height":h+"px"})}},initEvent:function(){var that=this;this.uploader.on("filesQueued",$.proxy(this.queueComplete,this)),this.uploader.on("uploadProgress",function(file,percentage){that.uploadProgress(file,percentage)}),this.uploader.on("error",that.showError),this.uploader.on("uploadError",function(file,err){that.showError(err)}),this.uploader.on("startUpload",this.option.startUpload),this.uploader.on("uploadSuccess",function(file,data){that.success.call(that,file,data)}),this.uploader.on("uploadBeforeSend",this.option.uploadBeforeSend)},queueComplete:function(){this.$queue.show(),this.option.auto||this.upload()},upload:function(){!this.option.auto&&this.option.beforeUpload()?this.uploader.upload():this.clear()},uploadProgress:function(file,percentage){percentage=100*percentage,this.$queue.find("b").html(percentage+"%"),this.$queue.find("div").css("width",percentage+"%")},success:function(file,data){var that=this;"function"==typeof that.option.successUpload?that.option.successUpload.call(that,data):this.$input.val(data.name),this.$parent.find(".ticon-attach").length>0?this.$parent.find(".ticon-attach").html('<img src="'+data.url+'" alt=""><b>'+data.url+"</b>"):this.$parent.prepend('<span class="ticon-attach"><img src="'+data.url+'" alt=""><b>'+data.url+"</b></span>"),setTimeout(function(){that.clear()},2e3)},clear:function(){var that=this;this.$queue.stop(!0,!0).fadeOut(300,function(){that.$queue.find("b").html("0%"),that.$queue.find("div").css("width","0%"),that.uploader.reset()})},showError:function(err,param){var message=FileUpload.errMsg[err]?FileUpload.errMsg[err]:err;alert(message)}};var Handler=function(option){var selector=$(this).selector;return $(this).each(function(){var that=$(this),data=that.data("uploadFile");data||that.data("uploadFile",data=new FileUpload(that,option,selector)),"string"==typeof option&&data[option]&&data[option]()})};$.fn.fileUpload=Handler,$.fn.fileUpload.constructor=FileUpload,root.FileUpload=FileUpload}(window,jQuery);